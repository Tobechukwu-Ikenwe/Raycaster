#include "map.h"

/*
 * Dungeon maze: 24x24. 0=empty, 1=wall, 2=locked door, 3=key, 4=green exit door.
 * Get the key, pass the brown locked door, reach the green door to win.
 */
const std::array<std::array<int, Map::width>, Map::height> Map::layout = {{
    {{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1}},
    {{1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,1}},
    {{1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,1}},
    {{1,0,0,0,1,1,1,1,0,0,1,1,1,1,1,0,0,0,1,1,1,0,0,1}},
    {{1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,1}},
    {{1,1,1,1,0,0,0,1,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,1}},
    {{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1}},
    {{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1}},
    {{1,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,1}},
    {{1,0,0,0,0,0,0,0,1,3,0,0,1,0,0,0,0,0,0,0,0,0,0,1}},
    {{1,0,0,0,0,0,0,0,1,0,0,0,1,1,1,1,1,1,0,0,0,0,0,1}},
    {{1,1,1,1,1,1,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1}},
    {{1,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,0,0,1,1,1,1}},
    {{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1}},
    {{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1}},
    {{1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1}},
    {{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1}},
    {{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1}},
    {{1,0,0,0,0,0,1,1,1,1,1,2,1,1,1,1,1,0,0,0,0,0,0,1}},
    {{1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1}},
    {{1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1}},
    {{1,0,0,0,0,0,1,0,0,0,0,0,0,0,4,0,1,0,0,0,0,0,0,1}},
    {{1,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,1}},
    {{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1}}
}};

int Map::getCell(int x, int y) {
    if (x < 0 || x >= width || y < 0 || y >= height) return Cell::Wall;
    return layout[y][x];
}

bool Map::isBlocking(int x, int y, bool hasKey) {
    if (x < 0 || x >= width || y < 0 || y >= height) return true;
    int c = layout[y][x];
    if (c == Cell::Wall) return true;
    if (c == Cell::Door) return !hasKey;  // brown door opens when you have the key
    return false;
}
